networks:
  proxy:
    external: true

services:
  photon:
    container_name: photon
    image: photon:latest
    restart: unless-stopped
    volumes:
      - ./data:/photon/photon_data
    environment:
      - UPDATE_STRATEGY=PARALLEL
      - UPDATE_INTERVAL=1d
      - LOG_LEVEL=DEBUG
      - COUNTRY_CODE=us
    build:
      context: ../../dockerfiles/photon
      dockerfile: Dockerfile
      args:
        - PHOTON_VERSION=0.6.2
    networks:
      - proxy
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.photon.middlewares=crowdsec-traefik-bouncer,auth"
      - "traefik.http.routers.photon.rule=Host(`geo.conway.dev`)"
      - "traefik.http.routers.photon.tls=true"
      - "traefik.http.routers.photon.tls.certresolver=prod"
      - "traefik.http.services.photon.loadbalancer.server.port=2322"
